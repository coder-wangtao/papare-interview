小程序的架构模型有别与传统 web 单线程架构，小程序为双线程架构。
微信小程序的渲染层与逻辑层分别由两个线程管理，渲染层的界面使用 webview 进行渲染;逻辑层采用 Jscore 运行 Javascript 代码。

可以从图中看出，由于渲染层与逻辑层分开，一个小程序有多个界面，所以渲染层对应存在多个 webview。这两个线程之间由 Native 层进行统一处理。无论是线程之间的通讯、数据的传递、网络请求都由 Native 层做转发。

因此微信小程序选择了 Hybrid 技术，界面主要由成熟的 Web 技术渲染，辅之以大量的接口提供丰富的客户端原生能力。同时，每个小程序页面都是用不同的 WebView 去渲染，这样可以提供更好的交互体验，更贴近原生体验，也避免了单个 WebView 的任务过于繁重。

「渲染层：」 界面渲染相关的任务全都在 WebView 线程里执行，通过逻辑层代码去控制渲染哪些界面。一个小程序存在多个界面，所以渲染层存在多个 WebView。
原先是 ExParser(基于 webComponent) => 现在是 glass-easel
Skyline 渲染引擎：在 WebView 渲染之外新增了一个渲染引擎 Skyline，Skyline 创建了一条渲染线程来负责 Layout, Composite 和 Paint 等渲染任务，并在 AppService 中划出一个独立的上下文，来运行之前 WebView 承担的 JS 逻辑、DOM 树创建等逻辑。

「逻辑层：」 创建一个单独的线程去执行 JavaScript，在这个环境下执行的都是有关小程序业务逻辑的代码。

那么，这里采用双线程的好处有哪些呢?在我看来，至少有如下几个点的好处

1.避免单线程阻塞问题
我们知道，浏览器在渲染页面时，靠的是渲染线程进行渲染，所有的活儿都依赖于这个单线程，因此页面的渲染和 js 的执行是互斥的。

2.多个 webview 更接近于原生应用的体验
在浏览器的单页应用中，渲染页面是通过路由识别随后动态将页面挂载到 root 节点中去，如果单页面应用打开一个新的页面，需要先卸
载掉当前页面结构，并且重新渲染。但是原生 APP 并不是这个样子，比较明显的特征为从页面右侧向左划入一个新的页面，并且我们可以同时看到两个页面。

3.依赖 Native 层做转发，逻辑层与渲染层更加专注于自身的责任
双线程的好处不仅仅是一分为二而已，还有强大的 Native 层做背后支撑。
Native 层除了做一些资源的动态注入，还负责着很多的事情，请求的转发，离线存储，组件渲染等等。界面主要由成熟的 Web 技术渲染，辅之以大量的接口提供丰富的客户端原生能力。同时，每个小程序页面都是用不同的 WebView 去渲染，这样可以提供更好的交互体验，更贴近原生体验，也避免了单个 webview 的任务过于繁重。
有了 Native 层这么一个靠山后，让逻辑层与渲染层更加专注于自身的责任。

这个架构的好处是:分开了业务主线程和显示界面，即便业务主线程非常繁忙，也不会阻塞用户在 page-frame 上的交互。
一个小程序可以有多个 page-frame(webview)，页面间切换动画比 SPA 更流畅。但是，这样的架构也不是说没有缺点，该架构的缺点就在于在 page-frame 上无法调用业务 JS。跨线程通信的成本很高，不适合需要频繁通信的场景。业务 JS 无法直接控制 DOM。
因此，针对微信小程序架构的缺点，微信团队推出了 WXS. WXS 就是在 page-frame 中运行的 JS，可以对 view 数据做一些变换。WXS 对性能的贡献就只有一点:与 WXML 是在同一个线程运行的，避免了跨线程通信的开销。简单来说就是可以在 WXML 里使用 JavaScript。
